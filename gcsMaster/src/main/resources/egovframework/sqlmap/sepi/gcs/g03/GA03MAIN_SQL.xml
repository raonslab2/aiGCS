<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="GA03MAIN">

	<typeAlias alias="egovMap"
		type="egovframework.rte.psl.dataaccess.util.EgovMap" />
	<typeAlias alias="gA03MAINVO"
		type="egovframework.or.kr.GA03MAIN.service.GA03MAINVO" />
	<typeAlias alias="DeviceVO"
		type="egovframework.or.kr.GA03MAIN.service.DeviceVO" />



	<insert id="GA03MAIN.insertWaypoint" parameterClass="Map">
		<![CDATA[
			 INSERT INTO br_drone_waypoints
				(
				   dl_project_dl_pk,
				   dl_waypoint, 
				   dl_waypoint_detail
				)
				VALUES
				(
				  #DL_PROJECT_DL_PK#,
				  #DL_WAYPOINT#,
				  #DL_WAYPOINT_DETAIL#
				) 
		]]>
	</insert>

	<insert id="GA03MAIN.insertDrone" parameterClass="Map">
		<![CDATA[
			INSERT INTO br_drone_path
			     ( 
			       path_dl_pk
			      ,path_dl_name 
			     )
   				VALUES 
	 			(
	 			  #DL_PK#
	 			 ,#DL_NAME# 
	 			) 
		]]>
	</insert>

	<resultMap id="PathWaypointPk"
		class="egovframework.or.kr.GA03MAIN.service.GA03MAINVO">
		<result property="dlNamePk" column="dl_name_pk" columnIndex="1" />
	</resultMap>

	<select id="GA03MAIN.selectDroneSwarmPk"
		parameterClass="GA03MAINVO" resultMap="PathWaypointPk">
				<![CDATA[
						SELECT (ifnull(MAX(dl_pk),0)+1) dl_name_pk FROM br_drone_swarm_pk
				 ]]>
	</select>

	<insert id="GA03MAIN.insertSwarmWaypoint" parameterClass="Map">
		<![CDATA[
			INSERT INTO br_drone_swarm_waypoints
			     ( 
			       dl_name_pk
			      ,dl_name
			      ,dl_path_name
			      ,dl_addr 
			      ,dl_user_id 
			      ,dl_home_x 
			      ,dl_home_y 
			      ,dl_home_z 
			      ,dl_waypoint 
			     )
   				VALUES 
	 			(
	 			  #DL_NAME_PK#
	 			 ,#DL_NAME#
	 			 ,#DL_PATH_NAME# 
	 			 ,#DL_ADDR# 
	 			 ,#DL_USER_ID# 
	 			 ,#DL_HOME_X# 
	 			 ,#DL_HOME_Y# 
	 			 ,#DL_HOME_Z# 
	 			 ,#DL_WAYPOINT# 
	 			) 
		]]>
	</insert>

	<insert id="GA03MAIN.insertDroneSwarmPk" parameterClass="Map">
		<![CDATA[
			INSERT INTO br_drone_swarm_pk
			     ( 
			       dl_name_pk
			      ,dl_name_etc 
			      ,dl_name 
			      ,dl_user_id
			     )
   				VALUES 
	 			(
	 			  #DL_NAME_PK#
	 			 ,#DL_NAME_ETC# 
	 			 ,#DL_NAME# 
	 			 ,#DL_USER_ID# 
	 			) 
		]]>
	</insert>

	<insert id="GA03MAIN.insertProjectName" parameterClass="Map">
 
	    <![CDATA[
	        INSERT INTO br_drone_project
	            (
	              dl_name, 
	              dl_div, 
	              dl_home_x, 
	              dl_home_y, 
	              dl_codination,
	              dl_addr, 
	              dl_user_id
	            )
	            VALUES 
	            (
	              #DL_NAME#,
	              #DL_DIV#,
	              #DL_HOME_X#,
	              #DL_HOME_Y#,
	              #DL_CODINATION#,
	              "",
	              #DL_USER_ID#
	            ) 
	    ]]>
		<selectKey keyProperty="dlPk" resultClass="int">
			SELECT
			LAST_INSERT_ID() as dlPk
		</selectKey>
	</insert>



	<update id="GA03MAIN.updateWaypoint" parameterClass="Map">
    <![CDATA[
	 UPDATE br_drone_waypoints
		SET 
			dl_waypoint=#DL_WAYPOINT#,
			dl_waypoint_detail=#DL_WAYPOINT_DETAIL#
		WHERE dl_project_dl_pk=#DL_PROJECT_DL_PK# 
    ]]>
	</update>

	<update id="GA03MAIN.updateDroneProject" parameterClass="Map">
    <![CDATA[
	 UPDATE br_drone_project
		SET 
			dl_name=#DL_NAME# 
		WHERE dl_pk=#DL_PROJECT_DL_PK# 
    ]]>
	</update>


	<resultMap id="PathWaypointList"
		class="egovframework.or.kr.GA03MAIN.service.GA03MAINVO">
		<result property="dlPk" column="dl_pk" columnIndex="1" />
		<result property="dlName" column="dl_name" columnIndex="2" />
		<result property="dlDiv" column="dl_div" columnIndex="3" />
		<result property="dlAddr" column="dl_addr" columnIndex="4" />
		<result property="dlUserId" column="dl_user_id" columnIndex="5" />
		<result property="dlHomeX" column="dl_home_x" columnIndex="6" />
		<result property="dlHomeY" column="dl_home_y" columnIndex="7" />
		<result property="dlWaypoint" column="dl_waypoint"
			columnIndex="8" />
		<result property="dlWaypointDetail" column="dl_waypoint_detail"
			columnIndex="9" />
		<result property="dlCreateTime" column="dl_create_time"
			columnIndex="10" />
		<result property="dlModifyTime" column="dl_modify_time"
			columnIndex="10" />
	</resultMap>

	<select id="GA03MAIN.selectWaypoint" parameterClass="GA03MAINVO"
		resultMap="PathWaypointList">
			<![CDATA[
				 SELECT 
				     a.dl_pk, 
					  a.dl_name,  
					  a.dl_div, 
					  a.dl_addr, 
					  a.dl_user_id, 
					  a.dl_home_x, 
					  a.dl_home_y, 
					  b.dl_waypoint,
					  b.dl_waypoint_detail,
					  a.dl_create_time, 
					  a.dl_modify_time
					FROM br_drone_project a
					     LEFT JOIN br_drone_waypoints b
					     ON a.dl_pk = b.dl_project_dl_pk
					WHERE a.dl_user_id = #dlUserId#
					  and a.dl_pk = #dlPk# 
			 ]]>
	</select>

	<select id="GA03MAIN.selectWaypoint2"
		parameterClass="GA03MAINVO" resultMap="PathWaypointList">
			<![CDATA[
					SELECT 
					   a.dl_pk
					   ,a.dl_name
					   ,a.dl_div
					   ,a.dl_addr
					   ,a.dl_user_id
					   ,a.dl_home_x
					   ,a.dl_home_y
					   ,a.dl_waypoint
					   ,a.dl_waypoint_detail
					   ,a.dl_create_time
					 FROM br_drone_waypoints2 a
			      WHERE
				     dl_pk = #dlPk#
			 ]]>
	</select>


	<select id="GA03MAIN.selectWaypointList"
		parameterClass="GA03MAINVO" resultMap="PathWaypointList">
			<![CDATA[
					SELECT 
					   a.dl_pk
					   ,a.dl_name
					   ,a.dl_div
					   ,a.dl_addr
					   ,a.dl_user_id
					   ,a.dl_home_x
					   ,a.dl_home_y
					   ,a.dl_waypoint
					   ,a.dl_waypoint_detail
					   ,a.dl_create_time
					 FROM br_drone_waypoints a
					]]>
		<isNotEmpty property="dlUserId">
			where a.dl_user_id LIKE CONCAT('%',#dlUserId#,'%')
		</isNotEmpty> 
				<![CDATA[
			 		ORDER BY a.dl_create_time desc 
			 		LIMIT #recordCountPerPage# OFFSET #firstIndex#
				]]>
	</select>

	<select id="GA03MAIN.selectWaypointListCnt"
		parameterClass="GA03MAINVO" resultClass="int">
		<![CDATA[      
		SELECT     
        	COUNT(*)
	    FROM
			br_drone_waypoints a
		]]>
		<isNotEmpty property="dlUserId">
			where a.dl_user_id LIKE CONCAT('%',#dlUserId#,'%')
		</isNotEmpty>
	</select>


	<resultMap id="selectListPjInfo"
		class="egovframework.or.kr.GA03MAIN.service.GA03MAINVO">
		<result property="dlPk" column="dl_pk" columnIndex="1" />
		<result property="dlName" column="dl_name" columnIndex="2" />
		<result property="dlDiv" column="dl_div" columnIndex="3" />
		<result property="dlAddr" column="dl_addr" columnIndex="4" />
		<result property="dlUserId" column="dl_user_id" columnIndex="5" />
		<result property="dlCreateTime" column="dl_create_time"
			columnIndex="6" />
		<result property="dlModifyTime" column="dl_modify_time"
			columnIndex="7" />
	</resultMap>

	<select id="GA03MAIN.selectListPj" parameterClass="GA03MAINVO"
		resultMap="selectListPjInfo">
			<![CDATA[
					 SELECT 
					      a.dl_pk,
					      a.dl_name, 
					      a.dl_div, 
					      a.dl_addr, 
					      a.dl_user_id, 
					      a.dl_create_time, 
					      a.dl_modify_time
						FROM br_drone_project a
						where a.dl_user_id = #dlUserId#
					]]>
				<![CDATA[
			 		ORDER BY a.dl_create_time desc 
			 		LIMIT #recordCountPerPage# OFFSET #firstIndex#
				]]>
	</select>

	<select id="GA03MAIN.selectListPjCnt"
		parameterClass="GA03MAINVO" resultClass="int">
		<![CDATA[      
		SELECT     
        	COUNT(*)
	    FROM
			br_drone_project a
		  where a.dl_user_id = #dlUserId#
		]]>
	</select>

	<select id="GA03MAIN.selectWaypointList2"
		parameterClass="GA03MAINVO" resultMap="PathWaypointList">
			<![CDATA[
					SELECT 
					   a.dl_pk
					   ,a.dl_name
					   ,a.dl_div
					   ,a.dl_addr
					   ,a.dl_user_id
					   ,a.dl_home_x
					   ,a.dl_home_y
					   ,a.dl_waypoint
					   ,a.dl_waypoint_detail
					   ,a.dl_create_time
					 FROM br_drone_waypoints2 a
					]]>
		<isNotEmpty property="dlUserId">
			where a.dl_user_id LIKE CONCAT('%',#dlUserId#,'%')
		</isNotEmpty> 
				<![CDATA[
			 		ORDER BY a.dl_create_time desc 
			 		LIMIT #recordCountPerPage# OFFSET #firstIndex#
				]]>

	</select>

	<select id="GA03MAIN.selectWaypointListCnt2"
		parameterClass="GA03MAINVO" resultClass="int">
		<![CDATA[      
		SELECT     
        	COUNT(*)
	    FROM
			br_drone_waypoints2 a
		]]>
		<isNotEmpty property="dlUserId">
			where a.dl_user_id LIKE CONCAT('%',#dlUserId#,'%')
		</isNotEmpty>
	</select>


	<resultMap id="PathWaypointSwarmList"
		class="egovframework.or.kr.GA03MAIN.service.GA03MAINVO">
		<result property="dlPk" column="dl_pk" columnIndex="1" />
		<result property="dlNamePk" column="dl_name_pk" columnIndex="2" />
		<result property="dlName" column="dl_name" columnIndex="3" />
		<result property="dlNameEtc" column="dl_name_etc"
			columnIndex="4" />
		<result property="dlUserId" column="dl_user_id" columnIndex="5" />
		<result property="dlDroneNum" column="dlDroneNum"
			columnIndex="6" />
		<result property="dlCreateTime" column="dl_create_time"
			columnIndex="7" />
	</resultMap>

	<select id="GA03MAIN.selectWaypointSwarmList"
		parameterClass="GA03MAINVO" resultMap="PathWaypointSwarmList">
			<![CDATA[
					SELECT 
					   a.dl_pk
					   ,a.dl_name_pk
					   ,a.dl_name 
					   ,a.dl_name_etc 
					   ,a.dl_user_id
					   ,(SELECT COUNT(*) FROM br_drone_swarm_waypoints WHERE dl_name_pk = a.dl_name_pk) AS dlDroneNum
					   ,a.dl_create_time
					 FROM br_drone_swarm_pk a
					]]>
		<isNotEmpty property="dlUserId">
			where a.dl_user_id LIKE CONCAT('%',#dlUserId#,'%')
		</isNotEmpty> 	
				<![CDATA[
			 		ORDER BY a.dl_create_time desc 
			 		LIMIT #recordCountPerPage# OFFSET #firstIndex#
				]]>

	</select>

	<select id="GA03MAIN.selectWaypointSwarmListCnt"
		parameterClass="GA03MAINVO" resultClass="int">
		<![CDATA[      
		SELECT     
        	COUNT(*)
	    FROM
			br_drone_swarm_pk a
		]]>
		<isNotEmpty property="dlUserId">
			where a.dl_user_id LIKE CONCAT('%',#dlUserId#,'%')
		</isNotEmpty>
	</select>

	<select id="GA03MAIN.selectDroneSwarmPkList"
		parameterClass="GA03MAINVO" resultMap="PathWaypointSwarmList">
			<![CDATA[
					SELECT 
					   a.dl_pk
					   ,a.dl_name_pk
					   ,a.dl_name 
					   ,a.dl_name_etc 
					   ,a.dl_user_id
					   ,(SELECT COUNT(*) FROM br_drone_swarm_waypoints WHERE dl_name_pk = a.dl_name_pk) AS dlDroneNum
					   ,a.dl_create_time
					 FROM br_drone_swarm_pk a
			      WHERE
				     dl_pk = #dlPk#
			 ]]>
	</select>

	<update id="GA03MAIN.updateDroneSwarmPk" parameterClass="Map">
 		<![CDATA[
			UPDATE br_drone_swarm_pk SET 
				dl_name = #DL_NAME# ,
				dl_name_etc = #DL_NAME_ETC#,
				dl_user_id = #DL_USER_ID# 
			WHERE dl_pk = #DL_PK# 
 		]]>
	</update>

	<resultMap id="selectDroneListInfo"
		class="egovframework.or.kr.GA03MAIN.service.DeviceVO">
		<result property="aiPk" column="aiPk" columnIndex="1" />
		<result property="aiDevicename" column="aiDevicename"
			columnIndex="2" />
		<result property="aiDevicetype" column="aiDevicetype"
			columnIndex="3" />
		<result property="aiAgency" column="aiAgency" columnIndex="4" />
		<result property="aiMemo" column="aiMemo" columnIndex="5" />
		<result property="aiRegistername" column="aiRegistername"
			columnIndex="6" />
		<result property="aiWritetime" column="aiWritetime"
			columnIndex="7" />
		<result property="aiDevicecode" column="aiDevicecode"
			columnIndex="8" />
		<result property="aiRegisterid" column="aiRegisterid"
			columnIndex="9" />
		<result property="aiUse" column="aiUse" columnIndex="10" />
		<result property="aiDevicealias" column="aiDevicealias"
			columnIndex="11" />
	</resultMap>

	<select id="GA03MAIN.selectDroneList" parameterClass="DeviceVO"
		resultMap="selectDroneListInfo">
	     <![CDATA[
				SELECT 
				    ai_pk as aiPk
				   ,ai_devicename as aiDevicename
				   ,ai_devicetype as aiDevicetype
				   ,ai_agency as aiAgency 
				   ,ai_memo as aiMemo
				   ,ai_registername as aiRegistername
				   ,ai_writetime as aiWritetime
				   ,ai_devicecode as aiDevicecode
				   ,ai_registerid as aiRegisterid
				   ,ai_use as aiUse
				   ,ai_devicealias aiDevicealias
				 FROM br_tb_aircraft
				WHERE ai_use = #aiUse#
				 ORDER BY ai_devicename asc
				 
 		]]>
	</select>

	<select id="GA03MAIN.selectDroneListCnt"
		parameterClass="DeviceVO" resultClass="int">
 		<![CDATA[  
				SELECT 
				    COUNT(*)
				 FROM br_tb_aircraft
				WHERE ai_use = #aiUse# 
		 ]]>
	</select>


	<resultMap id="selectWaypointCheckInfo"
		class="egovframework.or.kr.GA03MAIN.service.GA03MAINVO">
		<result property="dlPk" column="dl_pk" columnIndex="1" />
	</resultMap>

	<select id="GA03MAIN.selectWaypointCheck"
		parameterClass="GA03MAINVO" resultMap="selectWaypointCheckInfo">
			<![CDATA[
				SELECT dl_pk
					FROM br_drone_waypoints
					WHERE dl_project_dl_pk = #dlPk#
					]]>
	</select>

</sqlMap>
